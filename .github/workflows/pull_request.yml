name: 'Pull Request'

on:
  pull_request:
    branches: [ develop ]
    types: [opened, reopened, synchronize, closed]

jobs:
  notify:
    if: >
      github.event.pull_request.state == 'open' || github.event.pull_request.state == 'closed' || github.event.pull_request.state == 'merged'
    runs-on: ubuntu-latest
    steps:
      - name: Set text_color
        run: echo "text_color=$(if [ ${{ github.event.pull_request.state }} == 'closed' ]; then echo '00ff00'; else echo 'ff0000'; fi)" >> $GITHUB_ENV
      - name: ðŸ“£ Send teams notification
        uses: simbo/msteams-message-card-action@latest
        with:
          webhook: ${{ secrets.TEAMS_WEBHOOK_URL }}
          color: ${{ env.text_color }}
          title: ${{ github.workflow }}
          message: '<hr style="height:1px;color:#${{ env.text_color }};background-color:#${{ env.text_color }};">PR status: <div style="color:#ffffff;background-color:purple;!important">${{ github.event.pull_request.state }}</div><hr style="height:2px;margin-top:7px;color:#fff;background-color:#${{ env.text_color }};">'
          buttons: |
            View Pull Request ${{ github.event.pull_request._links.html.href  }}
            View Project https://github.com/orgs/uic-ts/projects/1
          sections: |
            -
              activityTitle:
              activitySubtitle:
              facts:
                -
                  name: "PR status:"
                  value: "`${{ github.event.pull_request.state }}`"
                -
                  name: "Repo:"
                  value: ${{ github.repository }}

                -
                  name: "Source branch:"
                  value: ${{ github.head_ref }}
                -
                  name: "Target branch:"
                  value: ${{ github.base_ref }}
                -
                  name: "Requested by:"
                  value: ${{ github.triggering_actor }}
                -
                  name: "Run attempts:"
                  value: ${{ github.run_attempt }}
                -
                  name: "PR #:"
                  value: ${{ github.event.pull_request.number }}
                -
                  name: "Review status:"
                  value: "`${{ github.event.pull_request_review.state }}`"
                -
                  name: "Reviewers:"
                  value: "
                    {% for reviewer in github.event.pull_request.requested_reviewers %}
                      {{ reviewer.login }}
                    {% endfor %}"
                -
                  name: "Commits in this PR:"
                  value: ${{ github.event.pull_request.commits }}
