name: 'Pull Request'
on:
  pull_request:
    branches: [develop]
    types: [opened, reopened, closed]


jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: ðŸª£ Set env vars
        run: |
          echo "MY_SPECIAL_BUTTON=Cool https://this-is-so.cool/" >> $GITHUB_ENV

      - name: ðŸ“£ Send teams notification
        uses: simbo/msteams-message-card-action@latest
        env:
          MY_AWESOME_BUTTON: Awesome http://this-is-so.awesome/
        with:
          webhook: ${{ secrets.TEAMS_WEBHOOK }}
          title: NULL
          message: <p>This is my <strong>awesome message!</strong></p>
          color: ff69b4
          buttons: |
            NULL https://whatever.com/foo/
            NULL https://somewhere.com/bar/
            This button will not be shown as it has no target URL
            https://no-label-no-button.com/
            ${{ env.MY_SPECIAL_BUTTON }}
            ${{ env.MY_AWESOME_BUTTON }}

      - name: ðŸŽ‰ Notify on merge
        if: github.event_name == 'pull_request' && github.event.action == 'closed' && github.event.pull_request.merged
        uses: simbo/msteams-message-card-action@latest
        env:
          MY_SPECIAL_BUTTON: "Special Button https://this-is-so.special/"
        with:
          webhook: ${{ secrets.TEAMS_WEBHOOK }}
          title: Pull Request merged!
          message: <p>The pull request ${github.event.pull_request.number} has been merged.</p>
          color: 00ff00
          buttons: |
            ${{ env.MY_SPECIAL_BUTTON }}
